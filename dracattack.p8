pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- drac attack
-- aquova

function _init()
	_upd=update_main
	_drw=draw_main
	
	screen=128
	drac={x=screen/2,y=screen/2,h=14,w=10,spd=1.5,direc="d"}
	fireballs={}
	debug=true
end

function _update()
	_upd()
end

function _draw()
	_drw()
end
-->8
-- main functions

function update_main()
	if btn(⬅️) then
		local newx=max(0,drac.x-drac.spd)
		drac.direc="l"
		if not checkmapcollision(newx,drac.y) then
			drac.x=newx
		end
	elseif btn(➡️) then
		local newx=min(drac.x+drac.spd,screen-drac.w)
		drac.direc="r"
		if not checkmapcollision(newx+drac.w,drac.y) then
			drac.x=newx
		end
	end
	
	if btn(⬆️) then
		local newy=max(0,drac.y-drac.spd)
		drac.direc="u"
		if not checkmapcollision(drac.x,newy)	then
			drac.y=newy
		end	
	elseif btn(⬇️) then
		local newy=min(drac.y+drac.spd,screen-drac.h)
		drac.direc="d"
		if not checkmapcollision(drac.x,newy+drac.h) then
			drac.y=newy
		end
	end
	
	if btnp(❎) then
		shoot()
	end
	
	for f in all(fireballs) do
		f.update()
	end
end

function draw_main()
	cls()
	palt(0,false)
	palt(11,true)
	map(0,0,0,0,16,16)
	if drac.direc=="d" then
		sspr(8,0,drac.w,drac.h,drac.x,drac.y)
	elseif drac.direc=="u" then
		sspr(18,0,drac.w,drac.h,drac.x,drac.y)	
	elseif drac.direc=="l" then
		sspr(29,0,drac.w,drac.h,drac.x,drac.y)	
	elseif drac.direc=="r" then
		sspr(29,0,drac.w,drac.h,drac.x,drac.y,drac.w,drac.h,true,false)
	end
	
	for f in all(fireballs) do
		f.draw()
	end
end
-->8
-- title screen

function update_title()
	if btnp(❎) or btnp(🅾️) then
		_upd=update_main
		_drw=draw_main
	end
end

function draw_title()

end
-->8
-- helper functions

function checkmapcollision(_x,_y)
	local tilex=flr(_x/8)
	local tiley=flr(_y/8)
	local tilespr=mget(tilex,tiley)

	return fget(tilespr,0)
end

function onscreen(_x,_y)
	if _x<0 or _x>screen then
		return false
	elseif _y<0 or _y>screen then
		return false
	end
	
	return true
end
-->8
-- player functions

function shoot()
	local f={}
	f.x=drac.x
	f.y=drac.y+3
	local spd=1
	if drac.direc=="d" then
		f.vx=0
		f.vy=spd
	elseif drac.direc=="u" then
		f.vx=0
		f.vy=-spd
	elseif drac.direc=="l" then
		f.vx=-spd
		f.vy=0
	elseif drac.direc=="r" then
		f.vx=spd
		f.vy=0
	end
	
	f.update=function(this)
		f.x+=f.vx
		f.y+=f.vy
		-- probably need to be modifed for width
		if not onscreen(f.x,f.y) then
			del(fireballs,f)
		end
	end
	
	f.draw=function(this)
		spr(16,f.x,f.y)
	end
	
	add(fireballs,f)
end
__gfx__
00000000bb000000bbbb000000bbbb000000bbbb5666666000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b00000000bb00000000bb00000000bbb6666660000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b0ff00ff0bb00000000bb0fff0000bbb6666600000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000b0ffffff0bb00000000bbf0ff0f00bbb6665500000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000dff0ff0ffdddddddddddbf0ff0ffdbbb6665500000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700dff0ff0ffdddddddddddbffffffddbbb6660000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ddffffffddddddddddddbbffffdddbbb6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bd80ff08dbbddddddddbbbb68dddbbbb6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb8888bbbd800008dbbddddddddbbbb08dddbbbb5666666600000000000000000000000000000000000000000000000000000000000000000000000000000000
b889988bbd806608dbbddddddddbbbb08dddbbbb6555555000000000000000000000000000000000000000000000000000000000000000000000000000000000
889aa988bd806608dbbddddddddbbbb08dddbbbb6555555000000000000000000000000000000000000000000000000000000000000000000000000000000000
89a77a98bd806608dbbddddddddbbbb08dddbbbb6555555000000000000000000000000000000000000000000000000000000000000000000000000000000000
89a77a98bdd0000ddbbddddddddbbbb08dddbbbb6555555000000000000000000000000000000000000000000000000000000000000000000000000000000000
889aa988bbb0bb0bbbbbb0bb0bbbbbbb00bbbbbb6555555000000000000000000000000000000000000000000000000000000000000000000000000000000000
b889988bbbb0bb0bbbbbb0bb0bbbbbbb00bbbbbb6555555000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb8888bbbbb6bb6bbbbbb6bb6bbbbbbb66bbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0515151515151515151515151515150500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0515151515151515151515151515150500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0515151515151515151515151515150500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0515151515151515151515151515150500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0515151515151515151515151515150500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0515151515151515151515151515150500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0515151515151515151515151515150500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0515151515151515151515151515150500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0515151515151515151515151515150500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0515151515151515151515151515150500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0515151515151515151515151515150500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0515151515151515151515151515150500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0515151515151515151515151515150500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0515151515151515151515151515150500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
