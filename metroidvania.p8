pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- metroidvania
-- by aquova

function _init()
	screen=128
	
	_upd=update_main
	_drw=draw_main
	
	p1={
		x=screen/2,
		y=screen/2,
		dx=0,
		dy=0,
		isgrounded=false,
		jumpspd=-4
	}
	
	g=0.4
end

function _update()
	_upd()
end

function _draw()
	_drw()
end
-->8
-- title functions

function update_title()
	if btnp(❎) or btnp(🅾️) then
		_upd=update_main
		_drw=draw_main
	end
end

function draw_title()
	cls()
	print("metroidvania",48,screen/2,12)
end
-->8
-- main functions

function update_main()
	move_player()
end

function draw_main()
	cls()
	fillp(0xa5a5)
	rectfill(0,0,screen,screen,1)
	fillp()
	spr(1,p1.x,p1.y)
	map(0,0,0,0,screen,screen)
end
-->8
-- player functions

function move_player()
	local startx=p1.x
	p1.dx=0
	
	-- move left/right
	if btn(⬅️) then
		p1.dx=-2
	elseif btn(➡️) then
		p1.dx=2
	end
	
	p1.x+=p1.dx
	
	-- check for wall
	local xoffset=0
	if p1.dx>0 then xoffset=7 end
	
	-- check flag of bottom center of player
	local v=mget((p1.x+xoffset)/8,(p1.y+7)/8)
	if fget(v,0) then
		p1.x=startx
	end
	
	-- jump
	if (btnp(⬆️) or btnp(❎)) and p1.isgrounded then
		p1.dy=p1.jumpspd
	end
	
	-- move y position by dy and by gravity
	p1.dy+=g
	p1.y+=p1.dy

	-- check for floor
	v=mget((p1.x+4)/8,(p1.y+8)/8)
	p1.isgrounded=false
	
	if p1.dy>=0 then
		if fget(v,0) then
			p1.y=flr(p1.y/8)*8
			p1.dy=0
			p1.isgrounded=true
		end
	end
	
	-- check for ceiling
	v=mget((p1.x+4)/8,p1.y/8)
	if p1.dy<=0 then
		if fget(v,0) then
			p1.dy=0
			p1.y=flr((p1.y+8)/8)*8
		end
	end
end
__gfx__
00000000000000007777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000007666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000dddd007666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000ddd0d07666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000dddd07666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000007666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000007666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000005555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200020200000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
