pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- diver
-- @aquova

function _init()
	screen=128
	mapwidth=2*screen
	tilesize=8
	maxdepth=0
	camoffset=-screen/2
	p1=newplayer()
	cam={x=0,y=camoffset+4}
	camera(cam.x,cam.y)
end

function _update()
	p1:update()
	p1:setcam()
end

function _draw()
	cls(12)
	rectfill(0,camoffset,mapwidth,0,7)
	map(0,0,0,0,mapwidth/8,mapwidth/8)
	p1:draw()
end
-->8
-- player

function newplayer()
	local p={
		x=screen/2,
		y=-4,
		dx=0,
		dy=0,
		horzspd=1,
		vertspd=-2,
		size=tilesize,
		sprt=1,
		flp=false,
		surface=true
	}
	
	function p:update()
		if self.dx>0 then
			self.dx=max(0,self.dx-0.1)
		else
			self.dx=min(0,self.dx+0.1)
		end
		
		if not self.surface then
			self.dy=min(self.dy+0.1,1)
		end
		
		if btn(⬅️) then
			self.dx=-self.horzspd
			self.flp=true
		elseif btn(➡️) then
			self.dx=self.horzspd
			self.flp=false
		end
		
		if self.surface then
			-- if at surface, drop
			if btnp(❎) then
				self.surface=false
			end
		else
			-- if under water, bounce
			if btnp(⬆️) then
				self.dy=self.vertspd
			end
		end
		
		-- if collision, don't move
		if is_collide(self.x,self.y,self.dx,true) then
			self.dx=0
		elseif is_collide(self.x,self.y,self.dy,false) then
			self.dy=0
		end
		
		self.x=mid(0,self.x+self.dx,mapwidth-self.size)
		self.y+=self.dy
		
		-- check if at surface
		if self.y<-self.size/2 then
			self.y=-self.size/2
			self.dy=0
			self.surface=true
		end
	end
	
	function p:setcam()
		cam.x=mid(0,self.x+camoffset,mapwidth-screen)
		cam.y=max(camoffset,self.y+camoffset)
		camera(cam.x,cam.y)
	end
	
	function p:draw()
		spr(self.sprt,self.x,self.y,1,1,self.flp)
		if self.surface then
			print("❎ to dive",self.x-14,self.y-8,8)
		end
	end
	
	return p
end
-->8
-- drawing

function drawbkg()

end
-->8
-- utilities

function is_collide(x,y,vel,horz)
 local test_x=x
 local test_y=y
 
 if vel>0 then
 	if horz then
 		test_x+=tilesize
 	else
 		test_y+=tilesize
 	end
 end
 
 if horz then
 	test_x+=vel
 else
 	test_y+=vel
 end
 
 local xcell=flr(test_x/tilesize)
 local ycell=flr(test_y/tilesize)
 local m=mget(xcell,ycell)
 return fget(m,0)
end

function is_vert_collide(y,dy)
	local test_y
end
__gfx__
00000000002222002222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000002222202222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000022fff02222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000022ff602222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700006d2d6002222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070006fdd0002222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000ddd0002222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000f0f0002222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020200000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
